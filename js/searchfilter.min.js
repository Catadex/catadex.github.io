function doSearch(){catDB=JSON.parse(inDB()),""===window.query&&(window.query=".*");let t=window.query.split(" "),e=[];for(let a=0;a<catDB.data.length;a++)for(let r=0;r<t.length;r++){let l=new RegExp(t[r],"i");l.test(fixQuery(catDB.data[a].name+" "+catDB.data[a].alt+" "+catDB.data[a].year))&&e.push(a)}let a=Array.from(new Set(e)),r={};e.forEach(function(t){r[t]?r[t]++:r[t]=1}),a.sort(function(t,e){return(r[e]||0)-(r[t]||0)});let l=a.map(t=>catDB.data[t]),n=document.querySelectorAll("section.filter filter[class*='tags']");for(let t=0;t<n.length;t++){let e=n[t].querySelectorAll("x.active");for(let a=0;a<e.length;a++)qPattern=new RegExp(e[a].getAttribute("data-value"),"i"),l=l.filter(e=>!qPattern.test(e.tags[t]))}catDB.data=l,writeOptions(),writePage(1)}